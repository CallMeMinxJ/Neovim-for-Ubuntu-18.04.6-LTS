#!/bin/bash
# =============================================================================
# Neovim 开发环境配置模块
# 此文件由初始化脚本自动生成，请勿手动修改
# =============================================================================

# 检查配置是否已加载
if [[ -n "${NVIM_DEV_CONFIG_LOADED:-}" ]]; then
    return 0
fi

export NVIM_DEV_CONFIG_LOADED=1

# =============================================================================
# 基础路径配置
# =============================================================================
export NVIM_DEV_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
export PATH="${NVIM_DEV_ROOT}/bin:${PATH}"

# =============================================================================
# XDG 基础目录规范配置
# =============================================================================
export XDG_CONFIG_HOME="${NVIM_DEV_ROOT}"
export XDG_DATA_HOME="${NVIM_DEV_ROOT}/.local/share"
export XDG_CACHE_HOME="${NVIM_DEV_ROOT}/.cache"

# 确保目录存在
mkdir -p "${XDG_DATA_HOME}" "${XDG_CACHE_HOME}" 2>/dev/null || true

# =============================================================================
# 工具路径配置
# =============================================================================
export CLANGD_PATH="${NVIM_DEV_ROOT}/tool/clangd-server/bin/clangd"
export LUA_LANGUAGE_SERVER_PATH="${NVIM_DEV_ROOT}/tool/lua-server/bin/lua-language-server"

# =============================================================================
# 别名定义
# =============================================================================
alias nvim="${NVIM_DEV_ROOT}/bin/nvim"
alias nvim-dev="nvim"
alias nvim-cfg="nvim \"${NVIM_DEV_ROOT}/nvim\""

# 插件管理命令
alias nvim-pack-sync="nvim --headless -c 'autocmd User PackerComplete quitall' -c 'PackerSync'"
alias nvim-pack-install="nvim --headless -c 'autocmd User PackerComplete quitall' -c 'PackerInstall'"

# =============================================================================
# 工具函数
# =============================================================================
nvim-dev-info() {
    echo "=== Neovim 开发环境信息 ==="
    echo "根目录: ${NVIM_DEV_ROOT}"
    echo "配置目录: ${XDG_CONFIG_HOME}"
    echo "数据目录: ${XDG_DATA_HOME}"
    echo "缓存目录: ${XDG_CACHE_HOME}"
    echo "Neovim 路径: $(command -v nvim)"
    echo "Neovim 版本: $(nvim --version 2>/dev/null | head -1 || echo '不可用')"
}

nvim-dev-clean() {
    echo "清理 Neovim 开发环境缓存..."
    rm -rf "${XDG_CACHE_HOME}/nvim" "${XDG_DATA_HOME}/nvim" 2>/dev/null
    echo "缓存清理完成"
}

nvim-dev-reload() {
    unset NVIM_DEV_CONFIG_LOADED
    # shellcheck source=/dev/null
    source "${NVIM_DEV_ROOT}/nvim.conf"
    echo "Neovim 开发环境配置已重新加载"
}

# =============================================================================
# 自动完成函数
# =============================================================================
if command -v complete >/dev/null 2>&1; then
    _nvim_dev_commands() {
        local cur prev words cword
        _get_comp_words_by_ref -n : cur prev words cword
        
        local commands="info clean reload"
        case "${cword}" in
            1)
                COMPREPLY=($(compgen -W "${commands}" -- "${cur}"))
                ;;
        esac
    }
    complete -F _nvim_dev_commands nvim-dev- 2>/dev/null || true
fi

