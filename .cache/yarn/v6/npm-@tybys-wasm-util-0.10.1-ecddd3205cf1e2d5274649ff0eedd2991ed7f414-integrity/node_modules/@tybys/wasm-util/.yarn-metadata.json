{
  "manifest": {
    "name": "@tybys/wasm-util",
    "version": "0.10.1",
    "description": "WASI polyfill for browser and some wasm util",
    "main": "./lib/cjs/index.js",
    "module": "./dist/wasm-util.esm-bundler.js",
    "types": "./dist/wasm-util.d.ts",
    "exports": {
      ".": {
        "module": "./dist/wasm-util.esm-bundler.js",
        "import": "./lib/mjs/index.mjs",
        "require": "./lib/cjs/index.js",
        "types": "./dist/wasm-util.d.ts"
      }
    },
    "scripts": {
      "build": "tsgo build",
      "watch": "tsgo watch",
      "test": "jest",
      "lint": "eslint ./src/**/*.{ts,js} --fix",
      "prepare": "npm run build"
    },
    "publishConfig": {
      "access": "public"
    },
    "keywords": [
      "wasm",
      "webassembly",
      "wasi",
      "polyfill"
    ],
    "repository": {
      "type": "git",
      "url": "https://github.com/toyobayashi/wasm-util.git"
    },
    "author": {
      "name": "toyobayashi"
    },
    "license": "MIT",
    "dependencies": {
      "tslib": "^2.4.0"
    },
    "devDependencies": {
      "@tybys/ts-transform-module-specifier": "^0.0.2",
      "@tybys/ts-transform-pure-class": "^0.1.1",
      "@tybys/tsgo": "^1.1.0",
      "@types/node": "^14.14.31",
      "@typescript-eslint/eslint-plugin": "^5.40.1",
      "@typescript-eslint/parser": "^5.40.1",
      "eslint": "^8.25.0",
      "eslint-config-standard-with-typescript": "^23.0.0",
      "eslint-plugin-import": "^2.26.0",
      "eslint-plugin-n": "^15.3.0",
      "eslint-plugin-promise": "^6.1.0",
      "memfs-browser": "^3.4.13000",
      "mocha": "^10.1.0",
      "ts-node": "^10.9.1",
      "typescript": "~4.8.3"
    },
    "_registry": "npm",
    "_loc": "/home/astor/neovim/.cache/yarn/v6/npm-@tybys-wasm-util-0.10.1-ecddd3205cf1e2d5274649ff0eedd2991ed7f414-integrity/node_modules/@tybys/wasm-util/package.json",
    "readmeFilename": "README.md",
    "readme": "# @tybys/wasm-util\n\nWebAssembly related utils for browser environment\n\n**The output code is ES2019**\n\n## Features\n\nAll example code below need to be bundled by ES module bundlers like `webpack` / `rollup`, or specify import map in browser native ES module runtime.\n\n### WASI polyfill for browser\n\nThe API is similar to the `require('wasi').WASI` in Node.js.\n\nYou can use `memfs-browser` to provide filesystem capability.\n\n- Example: [https://github.com/toyobayashi/wasi-wabt](https://github.com/toyobayashi/wasi-wabt)\n- Demo: [https://toyobayashi.github.io/wasi-wabt/](https://toyobayashi.github.io/wasi-wabt/)\n\n```js\nimport { load, WASI } from '@tybys/wasm-util'\nimport { Volume, createFsFromVolume } from 'memfs-browser'\n\nconst fs = createFsFromVolume(Volume.fromJSON({\n  '/home/wasi': null\n}))\n\nconst wasi = new WASI({\n  args: ['chrome', 'file.wasm'],\n  env: {\n    NODE_ENV: 'development',\n    WASI_SDK_PATH: '/opt/wasi-sdk'\n  },\n  preopens: {\n    '/': '/'\n  },\n  fs,\n\n  // redirect stdout / stderr\n\n  // print (text) { console.log(text) },\n  // printErr (text) { console.error(text) }\n})\n\nconst imports = {\n  wasi_snapshot_preview1: wasi.wasiImport\n}\n\nconst { module, instance } = await load('/path/to/file.wasm', imports)\nwasi.start(instance)\n// wasi.initialize(instance)\n```\n\nImplemented syscalls: [wasi_snapshot_preview1](#wasi_snapshot_preview1)\n\n### `load` / `loadSync`\n\n`loadSync` has 4KB wasm size limit in browser.\n\n```js\n// bundler\nimport { load, loadSync } from '@tybys/wasm-util'\n\nconst imports = { /* ... */ }\n\n// using path\nconst { module, instance } = await load('/path/to/file.wasm', imports)\nconst { module, instance } = loadSync('/path/to/file.wasm', imports)\n\n// using URL\nconst { module, instance } = await load(new URL('./file.wasm', import.meta.url), imports)\nconst { module, instance } = loadSync(new URL('./file.wasm', import.meta.url), imports)\n\n// using Uint8Array\nconst buffer = new Uint8Array([\n  0x00, 0x61, 0x73, 0x6d,\n  0x01, 0x00, 0x00, 0x00\n])\nconst { module, instance } = await load(buffer, imports)\nconst { module, instance } = loadSync(buffer, imports)\n\n// auto asyncify\nconst {\n  module,\n  instance: asyncifiedInstance\n} = await load(buffer, imports, { /* asyncify options */})\nasyncifiedInstance.exports.fn() // => return Promise\n```\n\n### Extend Memory instance\n\n```js\nimport { Memory, extendMemory } from '@tybys/wasm-util'\n\nconst memory = new WebAssembly.Memory({ initial: 256 })\n// const memory = instance.exports.memory\n\nextendMemory(memory)\nconsole.log(memory instanceof Memory)\nconsole.log(memory instanceof WebAssembly.Memory)\n// expose memory view getters like Emscripten\nconst { HEAPU8, HEAPU32, view } = memory\n```\n\n### Asyncify wrap\n\nBuild the C code using `clang`, `wasm-ld` and `wasm-opt`\n\n```c\nvoid async_sleep(int ms);\n\nint main() {\n  async_sleep(200);\n  return 0;\n}\n```\n\n```js\nimport { Asyncify } from '@tybys/wasm-util'\n\nconst asyncify = new Asyncify()\n\nconst imports = {\n  env: {\n    async_sleep: asyncify.wrapImportFunction(function (ms) {\n      return new Promise((resolve) => {\n        setTimeout(resolve, ms)\n      })\n    })\n  }\n}\n\n// async_sleep(200)\nconst bytes = await (await fetch('/asyncfied_by_wasm-opt.wasm')).arrayBuffer()\nconst { instance } = await WebAssembly.instantiate(bytes, imports)\nconst asyncifiedInstance = asyncify.init(instance.exports.memory, instance, {\n  wrapExports: ['_start']\n})\n\nconst p = asyncifedInstance._start()\nconsole.log(typeof p.then === 'function')\nconst now = Date.now()\nawait p\nconsole.log(Date.now() - now >= 200)\n```\n\n### wasi_snapshot_preview1\n\n- [x] args_get\n- [x] args_sizes_get\n- [x] environ_get\n- [x] environ_sizes_get\n- [x] clock_res_get\n- [x] clock_time_get\n- [ ] ~~fd_advise~~\n- [x] fd_allocate\n- [x] fd_close\n- [x] fd_datasync\n- [x] fd_fdstat_get\n- [ ] ~~fd_fdstat_set_flags~~\n- [x] fd_fdstat_set_rights\n- [x] fd_filestat_get\n- [x] fd_filestat_set_size\n- [x] fd_filestat_set_times\n- [x] fd_pread\n- [x] fd_prestat_get\n- [x] fd_prestat_dir_name\n- [x] fd_pwrite\n- [x] fd_read\n- [x] fd_readdir\n- [x] fd_renumber\n- [x] fd_seek\n- [x] fd_sync\n- [x] fd_tell\n- [x] fd_write\n- [x] path_create_directory\n- [x] path_filestat_get\n- [x] path_filestat_set_times\n- [x] path_link\n- [x] path_open\n- [x] path_readlink\n- [x] path_remove_directory\n- [x] path_rename\n- [x] path_symlink\n- [x] path_unlink_file\n- [x] poll_oneoff (timer only)\n- [x] proc_exit\n- [ ] ~~proc_raise~~\n- [x] sched_yield\n- [x] random_get\n- [ ] ~~sock_recv~~\n- [ ] ~~sock_send~~\n- [ ] ~~sock_shutdown~~\n"
  },
  "artifacts": [],
  "remote": {
    "resolved": "https://registry.npmjs.org/@tybys/wasm-util/-/wasm-util-0.10.1.tgz#ecddd3205cf1e2d5274649ff0eedd2991ed7f414",
    "type": "tarball",
    "reference": "https://registry.npmjs.org/@tybys/wasm-util/-/wasm-util-0.10.1.tgz",
    "hash": "ecddd3205cf1e2d5274649ff0eedd2991ed7f414",
    "integrity": "sha512-9tTaPJLSiejZKx+Bmog4uSubteqTvFrVrURwkmHixBo0G4seD0zUxp98E1DzUBJxLQ3NPwXrGKDiVjwx/DpPsg==",
    "registry": "npm",
    "packageName": "@tybys/wasm-util",
    "cacheIntegrity": "sha512-9tTaPJLSiejZKx+Bmog4uSubteqTvFrVrURwkmHixBo0G4seD0zUxp98E1DzUBJxLQ3NPwXrGKDiVjwx/DpPsg== sha1-7N3TIFzx4tUnRkn/Du3SmR7X9BQ="
  },
  "registry": "npm",
  "hash": "ecddd3205cf1e2d5274649ff0eedd2991ed7f414"
}